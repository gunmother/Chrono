:root{ --bg:#e3eaf2; --ink:#42586d; --icon-inactive:#42586d; --icon-active:#4ff7ff; --pressed-navy:#355169; --turq-glow: rgba(79,247,255,.75); --off:5px; --blur:9px; --hi:#ffffff; --lo:#b7c3d1; --gap:24px; --radius:12px; --border:#c6cfda; --grid-line:#cfd9e5; --chart-bg:#d1dce8; --mask-surface: var(--bg); --hour-col:64px; --dow-h:32px; --label-size:12px; --marquee-border:5px; --handle-stroke:#5e7286; --chev-stroke-w:2.2; --handle-gap:10px; --top-handle-extra:10px; --handle-height-mult:1.6; --stamp-gap:6px; --stamp-h:26px; --neu-shadow-outer: calc(-1*var(--off)) calc(-1*var(--off)) var(--blur) var(--hi), var(--off) var(--off) var(--blur) var(--lo); --neu-shadow-inner: inset calc(-1*var(--off)) calc(-1*var(--off)) var(--blur) var(--hi), inset var(--off) var(--off) var(--blur) var(--lo); --neu-offset-shadow: 8px 10px 20px rgba(0,0,0,.22); } html,body{ height:100%; margin:0; background:var(--bg); color:var(--ink); font:500 16px/1.4 system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif; overflow:auto; -webkit-tap-highlight-color: transparent; } *{box-sizing:border-box} .app{ width:clamp(320px, 96vw, 520px); min-height:100svh; margin:max(16px, env(safe-area-inset-top)) auto 40px; display:flex; flex-direction:column; gap:var(--gap); padding:0 var(--gap); } #screen{ min-height:420px; border-radius:var(--radius); background:var(--bg); box-shadow: var(--neu-shadow-outer); position:relative; overflow:hidden; } .controls{ display:flex; gap:var(--gap); padding-bottom:2px; } .neu-btn{ --btn-d: calc((100% - (3 * var(--gap))) / 4); flex:0 0 var(--btn-d); width:var(--btn-d); aspect-ratio:1/1; border-radius:50%; border:none; outline:none; cursor:pointer; background:var(--bg); display:grid; place-items:center; box-shadow: var(--neu-shadow-outer); transition: box-shadow .2s ease, background .2s ease, transform .06s ease; } .neu-btn svg{ width:86%; height:auto; stroke:var(--icon-inactive); stroke-width:1.25; fill:none; stroke-linecap:round; stroke-linejoin:round; filter: drop-shadow(-0.6px -0.6px 0 var(--hi)) drop-shadow(0.6px 0.6px 0 var(--lo)); } .neu-btn.is-pressed{ background: radial-gradient(circle at 82% 82%, rgba(79,247,255,.12) 0%, rgba(79,247,255,.07) 34%, rgba(79,247,255,0) 60%), var(--pressed-navy); box-shadow: var(--off) var(--off) var(--blur) var(--hi), calc(-1*var(--off)) calc(-1*var(--off)) var(--blur) var(--lo); } .neu-btn.is-pressed svg{ stroke:var(--icon-active); filter:drop-shadow(0 0 2px var(--turq-glow)) drop-shadow(0 0 10px var(--turq-glow)); } .neu-btn:active{ transform:scale(.985); } .wrap{ position:absolute; inset:0; display:grid; grid-template-rows:auto 1fr; min-width:0 } .head{ display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:8px; padding:8px 10px; } .title{ text-align:center; font-weight:800; font-size:16px; min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap } .grid-area{ position:relative; overflow:hidden } .hours{ position:absolute; top:var(--dow-h); bottom:0; left:0; width:var(--hour-col); pointer-events:none; z-index:0 } .hour-stamp{ position:absolute; right:8px; transform:translateY(-50%); font-size:var(--label-size); color:var(--ink); opacity:.95; white-space:nowrap; text-align:right; } .top-row{ position:absolute; top:0; left:var(--hour-col); right:0; height:var(--dow-h); display:grid; align-items:center; min-width:0 } .top-row.week{ grid-template-columns:repeat(7,1fr); column-gap:8px; padding:0 6px } .day-pill{ justify-self:center; border:none; padding:0 2px; text-align:center; font-size:clamp(11px, 2vw, 13px); background:transparent; color:var(--ink) } .grid{ position:absolute; top:var(--dow-h); left:var(--hour-col); right:0; bottom:0; background:var(--chart-bg); border-left:1px solid var(--grid-line); border-right:1px solid var(--grid-line); z-index:0; } .blocksHost{ position:absolute; inset:0; pointer-events:auto; z-index:0; } .blockRect{ position:absolute; border-radius:10px; border:none; cursor:pointer; } .mask{ position:absolute; inset:0; pointer-events:none; shape-rendering:crispEdges; z-index:1 } .overlayRoot{ position:fixed; inset:0; pointer-events:none; z-index:9999; } .ov{ position:absolute; pointer-events:none; } .marqueeRect{ box-sizing:border-box; background:transparent; border:var(--marquee-border) solid rgba(255,255,255,.95); border-radius:12px; box-shadow:0 0 14px rgba(79,247,255,.45); } .stamp{ position:absolute; left:50%; transform:translateX(-50%); background:var(--pressed-navy); color:var(--icon-active); border:1px solid #273b4d; border-radius:10px; padding:4px 8px; font-size:12px; font-variant-numeric:tabular-nums; font-weight:900; letter-spacing:.02em; white-space:nowrap; pointer-events:none; height:var(--stamp-h); display:grid; place-items:center; box-shadow: 0 0 2px rgba(79,247,255,.35), 0 0 10px rgba(79,247,255,.35); } .handle{ position:absolute; left:0; width:100%; pointer-events:auto; cursor:ns-resize; display:grid; place-items:center; } .chev-chip{ width:100%; height:100%; border-radius:14px; background:var(--bg); box-shadow: var(--neu-shadow-outer); display:grid; place-items:center; } .chev path{ fill:none; stroke:var(--handle-stroke); stroke-width:var(--chev-stroke-w); stroke-linecap:round; stroke-linejoin:round; filter: drop-shadow(-0.6px -0.6px 0 var(--hi)) drop-shadow(0.6px 0.6px 0 var(--lo)); } .liftShadow{ position:absolute; border-radius:14px; background:transparent; box-shadow:0 14px 28px rgba(0,0,0,.28); } .screensaver{ position:absolute; inset:0; display:grid; place-items:center; color:#667a90 } .screensaver .wm{ opacity:.8; font-weight:900; letter-spacing:.06em; } 

const screenEl = document.getElementById('screen'); const overlayRoot = document.getElementById('overlayRoot'); const SHORT_DOW=['Sun','Mon','Tue','Wed','Thu','Fri','Sat']; const MONTH_INIT=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']; const COLORS = ['#F7D6D0','#D6EEF5','#BFD9CF','#F7E08C','#E77D7A','#4EA1D6','#4FA684','#E5B21A','#E3423A','#1E6FB6','#187245','#D79516','#7F1D2D','#0E3B5C','#0A3A34','#C1730D']; function addDays(d,n){ const x=new Date(d); x.setDate(x.getDate()+n); return x; } function weekStart(d){ const x=new Date(d.getFullYear(), d.getMonth(), d.getDate()); const dow=x.getDay(); x.setDate(x.getDate()-dow); x.setHours(0,0,0,0); return x; } function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); } function snap15(n){ return 15 * Math.round((+n||0)/15); } function hourToAMPM(h){ return h===0? '12 AM' : h<12? \`\${h} AM\` : h===12? '12 PM' : \`\${h-12} PM\`; } function HHMM_24(min){ const m=((Math.round(min)|0)+1440)%1440; const h=Math.floor(m/60), r=m%60; return \`\${String(h).padStart(2,'0')}:\${String(r).padStart(2,'0')}\`; } const DAY_MS = 86400000; let visibleWeekFirst = weekStart(new Date()); let weekGeom=null; function computeGeometry(gridEl, cols){ const r=gridEl.getBoundingClientRect(); const totalW=Math.max(0, Math.round(r.width)); const totalH=Math.max(0, Math.round(r.height)); const colWBase=Math.floor(totalW/cols), extraW=totalW-colWBase*cols; const rowHBase=Math.floor(totalH/24), extraH=totalH-rowHBase*24; const colW=[], colX=[0]; for(let c=0;c<cols;c++){ const w=colWBase+(c<extraW?1:0); colW.push(w); colX.push(colX[c]+w); } const rowH=[], rowY=[0]; for(let i=0;i<24;i++){ const h=rowHBase+(i<extraH?1:0); rowH.push(h); rowY.push(rowY[i]+h); } const slotY=[0]; for(let hr=0;hr<24;hr++){ const h=rowH[hr]; const base=Math.floor(h/4); let rem=h-base*4; const parts=[base,base,base,base]; for(let k=0;k<rem;k++) parts[k]+=1; for(let q=0;q<4;q++) slotY.push(slotY[slotY.length-1]+parts[q]); } weekGeom={totalW,totalH,colW,colX,rowH,rowY,slotY, rect:r}; } const blocks=[]; function drawBlocks(){ const host=document.getElementById('blocksHost'); if(!host || !weekGeom) return; host.innerHTML=''; const wst=+visibleWeekFirst; for(const seg of blocks.filter(b=>b.weekSt===wst)){ const b=boundsFromSeg(seg); const el=document.createElement('div'); el.className='blockRect'; el.style.left = \`\${b.offsetLeft}px\`; el.style.top=\`\${b.topY}px\`; el.style.width=\`\${b.colWidth}px\`; el.style.height=\`\${b.height}px\`; el.style.background = seg.colorHex || COLORS[8]; host.appendChild(el); } } function idxFromMin(min){ return clamp(Math.round(min/15), 0, 96); } function boundsFromSeg(seg){ const colLeft = weekGeom.colX[seg.dayIdx]; const colRight= weekGeom.colX[seg.dayIdx+1]; const colWidth= (colRight - colLeft) - (seg.dayIdx===6?1:0); const idx = idxFromMin(seg.startMin); const idx2= idxFromMin(seg.endMin); const topY = weekGeom.slotY[idx]; const botY = weekGeom.slotY[idx2]; const height= Math.max(1, botY - topY); return {offsetLeft:colLeft, colWidth, topY, botY, height}; } function buildWeekView(){ screenEl.innerHTML = \` <div class="wrap"> <div class="head"> <button id="prevWeekBtn" class="neu-btn" title="Prev">◀</button> <div class="title" id="weekTitle"></div> <button id="nextWeekBtn" class="neu-btn" title="Next">▶</button> </div> <div class="grid-area"> <div class="top-row week" id="dowPills"></div> <div class="grid" id="weekGrid" role="grid"> <div class="blocksHost" id="blocksHost"></div> <svg class="mask" id="maskSVG" aria-hidden="true"></svg> </div> <div class="hours" id="weekHours"></div> </div> </div>\`; document.getElementById('prevWeekBtn').onclick = ()=>{ visibleWeekFirst=addDays(visibleWeekFirst,-7); repaintWeek(); drawBlocks(); clearSelector(); }; document.getElementById('nextWeekBtn').onclick = ()=>{ visibleWeekFirst=addDays(visibleWeekFirst, 7); repaintWeek(); drawBlocks(); clearSelector(); }; repaintWeek(); const grid = document.getElementById('weekGrid'); grid.addEventListener('click', onWeekGridTap); new ResizeObserver(()=>{ repaintWeek(true); drawBlocks(); if(chain) drawSelector(); }).observe(grid); window.addEventListener('scroll', onScrollUpdate, {passive:true}); } function repaintWeek(skipMask){ const first=visibleWeekFirst, last=addDays(first,6); document.getElementById('weekTitle').textContent = \`\${MONTH_INIT[first.getMonth()]} \${first.getDate()} - \${MONTH_INIT[last.getMonth()]} \${last.getDate()}\`; const pills=document.getElementById('dowPills'); pills.innerHTML=''; for(let i=0;i<7;i++){ const el=document.createElement('div'); el.className='day-pill'; el.textContent = SHORT_DOW[i]; pills.appendChild(el); } const gh=document.getElementById('weekHours'); gh.innerHTML=''; const gridEl=document.getElementById('weekGrid'); computeGeometry(gridEl,7); for(let i=0;i<24;i++){ const s=document.createElement('div'); s.className='hour-stamp'; s.textContent = hourToAMPM(i); s.style.top=((weekGeom.rowY[i]+weekGeom.rowY[i+1])/2)+'px'; gh.appendChild(s); } if(!skipMask) buildMask(weekGeom,7); } function buildMask(geom, cols){ const svg=document.getElementById('maskSVG'); svg.innerHTML=''; const { totalW, totalH, colX, rowY } = geom; if(totalW<=0 || totalH<=0) return; svg.setAttribute('width', totalW); svg.setAttribute('height', totalH); svg.setAttribute('viewBox', \`0 0 \${totalW} \${totalH}\`); svg.setAttribute('preserveAspectRatio','none'); const NS='http://www.w3.org/2000/svg'; const surface=getComputedStyle(document.documentElement).getPropertyValue('--mask-surface')||'#e3eaf2'; for(let rI=0;rI<24;rI++){ for(let cI=0;cI<cols;cI++){ const rect=document.createElementNS(NS,'rect'); rect.setAttribute('x',colX[cI]); rect.setAttribute('y',rowY[rI]); rect.setAttribute('width',colX[cI+1]-colX[cI]); rect.setAttribute('height',rowY[rI+1]-rowY[rI]); rect.setAttribute('fill',surface); svg.appendChild(rect); } } } let chain=null; function onWeekGridTap(e){ if(!weekGeom) return; const rect = weekGeom.rect; const relX = e.clientX - rect.left; const relY = e.clientY - rect.top; let dayIdx=0; for(let i=0;i<7;i++){ if(relX >= weekGeom.colX[i] && relX < weekGeom.colX[i+1]){ dayIdx=i; break; } } const minuteFloat = clamp(relY / weekGeom.totalH, 0, 1) * 1440; let startMin = snap15(Math.floor(minuteFloat/60)*60); let endMin = clamp(startMin + 60, 0, 1440); chain = { parent: {weekSt:+visibleWeekFirst, dayIdx, startMin, endMin}, child:null, dir:null }; drawSelector(); } function chevronsSVG(dir, width, rowH){ const w = Math.max(24, width - 16); const h = Math.max(44, Math.floor(rowH*1.6)); const mid = w/2; const gap = h/6; const span = Math.min(w*0.42, h/4); const triUp = (y)=>\`M \${mid-span} \${y+span} L \${mid} \${y} L \${mid+span} \${y+span}\`; const triDn = (y)=>\`M \${mid-span} \${y} L \${mid} \${y+span} L \${mid+span} \${y}\`; const d1 = (dir==='up'? triUp(gap) : triDn(gap)); const d2 = (dir==='up'? triUp(gap*2.2) : triDn(gap*2.2)); const d3 = (dir==='up'? triUp(gap*3.4) : triDn(gap*3.4)); return \`<div class="chev"><svg width="\${w}" height="\${h}" viewBox="0 0 \${w} \${h}" aria-hidden="true"><path d="\${d1}"/><path d="\${d2}"/><path d="\${d3}"/></svg></div>\`; } function drawSelector(){ overlayRoot.innerHTML=''; if(!chain || !weekGeom) return; const addEntry=(seg, which, showTop, showBottom)=>{ const b=boundsFromSeg(seg); const gridRect = weekGeom.rect; const left = Math.round(gridRect.left + weekGeom.colX[seg.dayIdx]); const top = Math.round(gridRect.top + b.topY); const width= Math.round(b.colWidth); const height=Math.round(b.height); const rowH = weekGeom.rowH[0] || 48; const hH = rowH * 1.6; const sGap = 6; const sH = 26; const hGap=10; const topExtra=10; const wrap = document.createElement('div'); wrap.className='ov'; wrap.style.left=\`\${left}px\`; wrap.style.top=\`\${top}px\`; wrap.style.width=\`\${width}px\`; wrap.style.height=\`\${height}px\`; const rect = document.createElement('div'); rect.className='marqueeRect'; rect.style.inset='0'; wrap.appendChild(rect); if(showTop){ const topStamp=document.createElement('div'); topStamp.className='stamp'; topStamp.textContent=HHMM_24(seg.startMin); topStamp.style.left=(width/2)+'px'; topStamp.style.top=(- (sGap + sH))+'px'; wrap.appendChild(topStamp); const topHandle=document.createElement('div'); topHandle.className='handle top'; topHandle.style.left='0'; topHandle.style.top=(- (sGap + sH + hGap + hH + topExtra))+'px'; topHandle.style.width=width+'px'; topHandle.style.height=hH+'px'; topHandle.innerHTML = \`<div class="chev-chip">\${chevronsSVG('up', width, rowH)}</div>\`; topHandle.addEventListener('pointerdown', ev=>startDrag(ev,'top', which), {passive:false}); wrap.appendChild(topHandle); } if(showBottom){ const botStamp=document.createElement('div'); botStamp.className='stamp'; botStamp.textContent=HHMM_24(seg.endMin%1440); botStamp.style.left=(width/2)+'px'; botStamp.style.top=(height + sGap)+'px'; wrap.appendChild(botStamp); const botHandle=document.createElement('div'); botHandle.className='handle bottom'; botHandle.style.left='0'; botHandle.style.top=(height + sGap + sH + hGap)+'px'; botHandle.style.width=width+'px'; botHandle.style.height=hH+'px'; botHandle.innerHTML = \`<div class="chev-chip">\${chevronsSVG('down', width, rowH)}</div>\`; botHandle.addEventListener('pointerdown', ev=>startDrag(ev,'bottom', which), {passive:false}); wrap.appendChild(botHandle); } overlayRoot.appendChild(wrap); }; const parentHere = chain.parent && chain.parent.weekSt===+visibleWeekFirst; const childHere = chain.child && chain.child.weekSt===+visibleWeekFirst; if(parentHere && !childHere){ addEntry(chain.parent,'parent',true,true); } else if(!parentHere && childHere){ addEntry(chain.child,'child',true,true); } else if(parentHere && childHere){ addEntry(chain.parent,'parent',true,false); addEntry(chain.child,'child',false,true); } } function onScrollUpdate(){ if(chain){ repaintWeek(true); drawSelector(); } } let dragKind=null, dragTarget='parent', dragStartY=0, baseStart=0, baseEnd=0, desiredEdgeIntent=null; function startDrag(ev, kind, which){ if(!chain || !weekGeom) return; const seg = (which==='parent'? chain.parent : chain.child); if(!seg) return; if(chain.child){ if(which==='parent' && kind==='bottom') return; if(which==='child' && kind==='top') return; } ev.preventDefault(); ev.stopPropagation(); ev.currentTarget.setPointerCapture(ev.pointerId); dragKind = kind; dragTarget = which; dragStartY = ev.clientY; baseStart = seg.startMin; baseEnd = seg.endMin; desiredEdgeIntent=null; const move=(e)=>{ const dyPx = e.clientY - dragStartY; const movedMin = (weekGeom.totalH? (dyPx / weekGeom.totalH) * 1440 : 0); const snappedDelta = snap15(movedMin); let desiredStart = baseStart, desiredEnd = baseEnd; if(dragKind==='top'){ desiredStart = baseStart + snappedDelta; } else { desiredEnd = baseEnd + snappedDelta; } desiredEdgeIntent = null; if(dragKind==='top' && desiredStart < 0) desiredEdgeIntent='prev'; if(dragKind==='bottom' && desiredEnd > 1440) desiredEdgeIntent='next'; if(dragKind==='top'){ seg.startMin = clamp(baseStart + snappedDelta, 0, seg.endMin - 15); } else { seg.endMin = clamp(baseEnd + snappedDelta, seg.startMin + 15, 1440); } drawSelector(); }; const up=()=>{ let seg = (dragTarget==='parent'? chain.parent : chain.child); seg.startMin = snap15(seg.startMin); seg.endMin = snap15(seg.endMin); if(seg.endMin - seg.startMin < 15){ if(dragKind==='top') seg.startMin = seg.endMin - 15; else seg.endMin = seg.startMin + 15; } if(!chain.child && desiredEdgeIntent==='next'){ const p = chain.parent; p.endMin = 1440; const nextDay = (p.dayIdx<6)? {weekSt:p.weekSt, dayIdx:p.dayIdx+1} : {weekSt:p.weekSt+7*DAY_MS, dayIdx:0}; chain.child = { weekSt: nextDay.weekSt, dayIdx: nextDay.dayIdx, startMin: 0, endMin: 60 }; } if(!chain.child && desiredEdgeIntent==='prev'){ const p = chain.parent; p.startMin = 0; const prevDay = (p.dayIdx>0)? {weekSt:p.weekSt, dayIdx:p.dayIdx-1} : {weekSt:p.weekSt-7*DAY_MS, dayIdx:6}; chain.child = { weekSt: prevDay.weekSt, dayIdx: prevDay.dayIdx, startMin: 1440-60, endMin: 1440 }; } drawSelector(); window.removeEventListener('pointermove', move); window.removeEventListener('pointerup', up); dragKind=null; desiredEdgeIntent=null; }; window.addEventListener('pointermove', move, {passive:false}); window.addEventListener('pointerup', up, {passive:true}); } function showScreensaver(){ screenEl.innerHTML = \` <div class="screensaver"><div class="wm">Chrono r83 — Week-only build</div></div>\`; } function buildMask(geom, cols){ const svg=document.getElementById('maskSVG'); svg.innerHTML=''; const { totalW, totalH, colX, rowY } = geom; if(totalW<=0 || totalH<=0) return; svg.setAttribute('width', totalW); svg.setAttribute('height', totalH); svg.setAttribute('viewBox', \`0 0 \${totalW} \${totalH}\`); svg.setAttribute('preserveAspectRatio','none'); const NS='http://www.w3.org/2000/svg'; const surface=getComputedStyle(document.documentElement).getPropertyValue('--mask-surface')||'#e3eaf2'; for(let rI=0;rI<24;rI++){ for(let cI=0;cI<cols;cI++){ const rect=document.createElementNS(NS,'rect'); rect.setAttribute('x',colX[cI]); rect.setAttribute('y',rowY[rI]); rect.setAttribute('width',colX[cI+1]-colX[cI]); rect.setAttribute('height',rowY[rI+1]-rowY[rI]); rect.setAttribute('fill',surface); svg.appendChild(rect); } } } function init(){ buildWeekView(); drawBlocks(); } init(); 